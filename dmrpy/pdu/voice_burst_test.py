from dmrpy.pdu.voice_burst import VoiceBurst

# Known good DMR bursts
data_head = 0x2B6004101F842DD00DF07D41046DFF57D75DF5DE30152E2070B20F803F88C695E2
voice_a = 0xB9E881526173002A6BB9E881526755FD7DF75F7173002A6BB9E881526173002A6A
voice_b = 0xB9E881526173002A6BB9E881526134E0F060691173002A6BB9E881526173002A6A
voice_c = 0xB9E881526173002A6BB9E881526171711004774173002A6BB9E881526173002A6A
voice_d = 0xB9E881526173002A6B954BE6500170C03181B74310B00777A6C6CB53732789483A
voice_e = 0x865AE7617555B50601B758E665115175A0F4E07124815001FFF5A337706128A7CA
voice_f = 0xEEE7817574614DF2FFCCF4A05511100000000E243059E7F9E908A0756202CCD622
voice_term = 0x2B0F04C41F342DA80D807DE104ADFF57D75DF5D965012D1877D203C03788DF95D1


# TODO EMB/embedded signalling decoding for voice superframes
VOICE_SUPERFRAME = [
    VoiceBurst(
        vs=0xF968F40102CDB76D9291739CA0E5295C4ECFBDB1E260C7E56CBA1E,
        emb=None,
        embedded_signalling=None,
    ),
    VoiceBurst(
        vs=0x4F50E8D839116FEF5B1C31AFFC596BEED8971A16AAB94E85EDA12B,
        emb=0x8D8B,
        embedded_signalling=0xACA0ACA9,
    ),
    VoiceBurst(
        vs=0xF968F40102CDB76D9291739CA0E5295C4ECFBDB1E260C7E56CBA1E,
        emb=0x75F7,
        embedded_signalling=0x5FD7DF71,
    ),
    VoiceBurst(
        vs=0x8138AB9E23BB520FD1C25AE9D86E3F01D407950CEBEF221316663,
        emb=0x8D8B,
        embedded_signalling=0xA6ACB7A6,
    ),
    VoiceBurst(
        vs=0xF968F40102CDB76D9291739CA0E5295C4ECFBDB1E260C7E56CBA1E,
        emb=0x75F7,
        embedded_signalling=0x5FD7DF71,
    ),
    VoiceBurst(
        vs=0x2A46ED983DAA4DF3D70F248DDAB382D20B130E34AFF8B1B1921B23,
        emb=0x8FF8,
        embedded_signalling=0xAFB4BBBB,
    ),
]


def test_create_with_sync():
    burst = VoiceBurst.create_from_burst_binary(
        0xF968F40102CDB76D9291739CA0E755FD7DF75F75295C4ECFBDB1E260C7E56CBA1E
    )
    assert burst.emb == None
    assert burst.embedded_signalling == None
    assert burst.vs == 0xF968F40102CDB76D9291739CA0E5295C4ECFBDB1E260C7E56CBA1E


def test_create_no_sync():
    burst = VoiceBurst.create_from_burst_binary(
        0x4F50E8D839116FEF5B1C31AFFC58DACA0ACA98B96BEED8971A16AAB94E85EDA12B
    )

    assert burst.embedded_signalling == 0xACA0ACA9
    assert burst.emb.raw() == 0x8D8B
    assert burst.vs == 0x4F50E8D839116FEF5B1C31AFFC596BEED8971A16AAB94E85EDA12B
